+++
title = "Trackball Mini V3: Руководство пользователя"
tags = ["docs", "trackball-v3"]
+++

![фотка трекбола](images/layouts/velvet_ui_ru.png)

**Trackball Mini V3** - обновленная ревизия полюбившегося многим компактного трекбола, теперь подключающегося к любым устройствам без проводов, с помощью Bluetooth, и имеющего 2 многофункциональные клавиши. Клавиши позволяют выполнять как базовые клики мыши, так и переключать режимы использования трекбола. В данном руководстве описаны все возможности трекбола, его режимы и процесс настройки.  


## Подключение трекбола

Шаг 0. Включаем Bluetooth на девайсе, к которому подключаете трекбол.

Шаг 1. Включаем трекбол, переведя переключатель питания на нижней крышке трекбола в положение ВКЛ.  

[фотка дна трекбола с выделенным переключателем]

Шаг 2. Клавиши для подключения трекбола к устройству находятся на *слое настроек*. Чтобы попасть на этот слой, одновременно нажимаем обе клавиши трекбола два раза подряд.  

Шаг 3. Нажимаем **левую клавишу** для выбора 0 профиля подключения.  

Шаг 4. Дважды нажимаем **левую клавишу** для очистки текущего профиля. После этого шага трекбол перейдёт в режим сопряжения и отобразится в списке доступных для подключения на девайсе, к которому подключаете трекбол. Подключаем. После подключения курсор уже будет перемещаться с помощью трекбола, но в замедленном режиме, для индикации того, что он находится на *слое настроек*.

Шаг 5. Для выхода с слоя настроек одновременно нажмите обе клавиши. После выхода с *слоя настроек* перемещение курсора трекболом значительно ускорится. Все, трекбол успешно подключен и готов к использованию!

Краткая сводка о действиях, доступных при нахождении на *слое настроек*:

- Нажатие **левой клавиши** выберет 0 профиль подключения (первого подключенного устройства);

- Нажатие **правой клавиши** переключит на следующий профиль подключения (всего доступно 5 профилей, начиная с 0);

- Двойное нажатие **левой кнопки** очистит текущий профиль, сделав его доступным для подключения к новому устройству;

- Двойное нажатие **правой кнопки** очистит все профили, сделав их доступными для подключения к новым устройствам;

- Одновременное нажатие **левой и правой кнопок** произведет выход из *слоя настроек*.


## Клавиши на базовом слое трекбола

![Еще одна фотка трекбола, поближе](/images/velvet-ui/trackball.jpg)

Две новые клавиши на трекболе позволяют использовать его полностью автономно от программируемых клавиатур, ведь все действия, выполняемые с помощью мыши, доступны с помощью нажатия клавиш и нужда в отдельном слое мыши на клавиатуре полностью отпала.  

Рассмотрим что клавиши умеют поподробнее.  

- **Левая клавиша** трекбола выполняет роль левой кнопки мыши (ЛКМ);  

- **Правая клавиша** трекбола **при кратковременном нажатии** выполнит клик правой кнопкой мыши (ПКМ), а **при удержании** клавиши нажатой активируется "снайперский" режим, в котором скорость перемещения курсора замедляется, позволяя наводиться курсором более точно;  

- **Одновременное нажатие обеих клавиш** производит клик средней кнопкой мыши (СКМ);  

- **Удержание обеих клавиш** переводит трекбол в режим скролла, кручение трекбола при этом будет производить прокрутку. Прокрутка происходит как по вертикали, так и по горизонтали, в зависимости от направления кручения трекбола.  


## Настройка клавиш трекбола

На клавиши трекбола можно назначить любое **поведение** с помощью <a href="https://journey.ergohaven.xyz/pages/docs/keymap-editor/" target="_blank">keymap editor</a>. 

Например, если вам не часто пригождается снайперский режим, но при этом вы очень часто используете режим скролла, то можно поменять их активацию местами - режим скролла активировать удержанием правой клавиши, а снайперский удержанием обеих клавиш.  

![картинка раскладки в keymap editor](/images/velvet-ui/capsen.png)  


## Прошивка, мониторинг заряда

Прошивка и мониторинг заряда происходят аналогично <a href="https://journey.ergohaven.xyz/pages/docs/keymap-editor/" target="_blank">беспроводным клавиатурам на ZMK</a>.


## Переключение режимов

Режимы скролла и снайпера активируются на заданных в конфигурации слоях, по умолчанию **1** и **2** соответственно, и если вы хотите использовать эти слои с какой-то другой целью, то можно перенести активацию этих режимов на любой другой слой. О том, как изменить номера слоев для режимов, рассказано в [Настройки режима скролла](#настройки-режима-скролла) и [Настройки снайперского режима](#настройки-снайперского-режима).  
  
В раскладке по умолчанию режимы переключаются с помощью поведения `&mo`, но переключать режимы можно и любым другим поведением, активирующим слои. Если не хочется удерживать кнопку режим скролла нажатой, то для включения режима можно использовать поведение `&tog 1`, тогда при однократном нажатии включится 1 слой вместе с режимом скролла, а при повторном нажатии 1 слой и режим скролла деактивируются.  

![скрин комбы, включающей скролл](/images/velvet-ui/mode-behavior.png)


## Конфигурирование трекбола

Все режимы трекбола можно настроить в файле `config/trackball.keymap`, это быстро и удобно можно сделать в интерфейсе GitHub, нажав кнопку **Edit this file**.

![image](/images/velvet-ui/github-edit.png)

Открываем файл в вашем форке и скроллим в самый низ, ищем строки:

```
&trackball { cpi = <1000>; };

&trackball_listener {
    input-processors = <&zip_xy_scaler 9 20>;

    scroller {
        layers = <1>;
        input-processors =
            <&zip_xy_transform INPUT_TRANSFORM_Y_INVERT>,
            <&zip_xy_scaler 1 32>,
            <&zip_xy_to_scroll_mapper>;
    };

    sniper {
        layers = <2>;
        input-processors = <&zip_xy_scaler 1 4>;
    };

    adjust {
        layers = <3>;
        input-processors = <&zip_xy_scaler 1 8>;
    };
};
```

Рассмотрим все доступные настройки.


### Чувствительность курсора в обычном режиме

Изменить чувствительность курсора в обычном режиме можно в строке `&trackball { cpi = <1000>; };`, значение `cpi` задается с шагом в *200*, и должно быть не больше *3200*. 

Дополнительно к параметру `cpi` также применяется множитель `<&zip_xy_scaler 9 20>`, означающий что итоговая чувствительность будет равна девяти двадцатых от изначального значения `cpi`. Это значение также можно изменять. 
```
&trackball_listener {
    input-processors = <&zip_xy_scaler 9 20>;
```
Подробнее о доступных `input-processors` можно почитать в документации ZMK: https://zmk.dev/docs/keymaps/input-processors


### Настройки режима скролла

Для режима скролла доступны следующие настройки:
```
scroller {
    layers = <1>;
    input-processors =
        <&zip_xy_transform INPUT_TRANSFORM_Y_INVERT>,
        <&zip_xy_scaler 1 32>,
        <&zip_xy_to_scroll_mapper>;
};
```
`layers = <1>;` - слои, на которых будет активен режим скролла. После изменения номера слоя надо также поменять и поведение, переключающее на слой с режимом скролла.
`<&zip_xy_transform INPUT_TRANSFORM_Y_INVERT>` - инвертирование скроллинга, можно инвертировать как по оси **Y**, так и по оси **X** (`<&zip_xy_transform INPUT_TRANSFORM_X_INVERT>`), или даже инвертировать обе оси, перечислив параметры через запятую: `<&zip_xy_transform INPUT_TRANSFORM_Y_INVERT>, <&zip_xy_transform INPUT_TRANSFORM_Х_INVERT>,`.
`<&zip_xy_scaler 1 32>` - скорость прокрутки задается в виде отношения, по умолчанию скорость равна одной тридцать второй. Можно как замедлить прокрутку, изменив значение, например на `<&zip_xy_scaler 1 64>`, так и ускорить прокрутку `<&zip_xy_scaler 2 32>`.


### Настройки снайперского режима

Для снайперского режима доступны следующие настройки:
```
sniper {
    layers = <2>;
    input-processors = <&zip_xy_scaler 1 4>;
};
```
`layers = <2>;` - слои, на которых будет активен снайперский режим. После изменения номера слоя надо также поменять и поведение, переключающее на слой с снайперским режимом.
`<&zip_xy_scaler 1 4>` - множитель скорости для режима снайпера. По умолчанию в режиме снайпера скорость трекбола уменьшается до одной четвертой.  

> Аналогичным образом настраивается и замедление курсора на слое настроек (`adjust`).  
